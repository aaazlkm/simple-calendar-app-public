# 予定をまとめて登録できるようにする #114

- todo
  - [x] ツールバー実装
  - [x] カレンダーアプリ入れてデザイン見てみる
  - [x] MultiDateRangePickerを実装する
  - [x] dribbbleみる modal系のデザインを確認したい
  - [x] option modal実装する
  - [x] タップしたらboudingアニメーションさせる
  - [x] 保存する時noteItemの状態によってnoteを保存するか決める
  - [x] メモを追加できるようにする
  - [x] modalの表示を改善する
  - [x] DateをsingleとMultiの状態をもつようにする
  - [x] optionが存在しなくなったら表示しないようにする
  - [x] イベント編集で保存するとmultiの時にうまくない
  - [x] 複数日登録するようにする
  - [x] multiで時間を指定できるようにする
  - [x] multi date pickerの月を選択できるようにする
  - [x] noteItemの削除ボタン調整
  - [x] option消える時にアニメーションさせる
  - [x] EventEditをもうちょい小さくする
  - [x] アイコンとのはばを短くする  -> 気持ち悪くなったのでやめる
  - [x] dateとかmodalで表示した方がわかりやすいせつ
  - [x] 多言語対応
  - [x] mulitiの時のView作成する
  - [x] 保存処理調整する
  - [x] 選択ボタンデザイン調整
  - [x] add optionデザイン調整
  - [x] デザインの調整をする
  - [x] リファクタリングする
  - [x] データ全て削除する処理を消す
  - [x] コード確認する
  - [x] 動作確認する

## dateとかmodalで表示した方がわかりやすいせつ

- Editの一部として編集する画面を追加してしまうと、表示する部分とEditする部分の見分けが月づらいため、使いづらい感じがする
  - そのため編集する時は全てmodalとして表示した方がわかりやすい感じがした
  - pro
    - 他の表示方法と統一がある
      - 複数DatePickerや AddOptionと統一が取れる
    - 入力した内容と、Editの内容が混ざらないのでわかりやすい
    - 単数日も入力しやすい
      - 現在の実装だと単数日を選択したい場合、選択した後に自分で閉じないといけない
  - con
    - modalは画面から一度抜けるため、没入かんがなくなってしまう感じがする
      - 多少重いタスクだけmodalにしたい
        - 日付は十分重いタスクだよな
      - テキスト入力に対していちいちmodal表示したらわかりづらい感じがする
- 他のアプリがどのようにしてるかみる
  - 1 ダイアログで表示する
  - 2 modalで表示する
- 結論
  - modalにする

## イベント編集で保存するとmultiの時にうまくない

- length == 1
  - eventの日付をそれにする
- length > 1
  - eventのevent dateが含まれていない場合
    - eventを削除する
  - else
    - eventと同じ日付は登録しない
- 行う処理
  - いったんイベントを削除して、上書きする

## mulitiの時のView作成する

- todo
  - [x] dribbbleで調べる
  - [x] 要素を横に並べる方法
  - [x] 表示する要素の数に制限をつけるか考える
  - [x] 省略して表示するようにする
  - [x] 要素のViewを作成する
  - [x] 消える時にアニメーションかける
  - [x] あまりの表示方法dribbbleで調べる
  - [x] eventDateの取得方法を考える
  - [x] multi pickerでeventDateは削除できないようにする
  - [x] multi pickerのevent作成方法を調整する
  - [x] muli pickerはtartget以外の要素を返すようにする
  - [x] multiDatePickerのdisplayEventの命名考える
  - [x] multi Itemの要素からtargetの日付を排除する
  - [x] eventDateがmultiに含まれていない時の処理
- `multiDatePickerのdisplayEventの命名考える`
  - 1
- `multi pickerでeventDateは削除できないようにする`
  - todo
    - [x] multiの表示をEventDateとその他で区別できるようにすること
    - [x] eventDate以外の要素の表示方法
  - eventDate以外の要素の表示方法
    - 1 背景opacityで表示
      - ちょっと日もうな感じがする
    - 2 テキストopacity
  - 結論
    - 背景、テキストどちらもopacity
- `eventDateがmultiに含まれていない時の処理`
  - 方法
    - 1 ~~eventDateがmultiに含まれていなかったら、eventDateの値をmulti.fisrtにする~~
      - eventDateがmultiに絶対に含まれるようにする処理
      - pro
        - 複数日のイベントを確認する時に、登録するイベントの全ての日付を確認することができる
      - con
        - 日付が勝手に変わってしまう
          - ユーザはなぜ日付が変わってしまったのかわからないので、使いづらく感じる
    - 2 eventDateがmultiに含まれていなかったら、eventDateの値をmultiに加える
      - eventDateがmultiに絶対に含まれるようにする処理
      - 複数日はあくまでEventDateの付属の情報であることを明示的にする
      - pro
        - 複数日のイベントを確認する時に、登録するイベントの全ての日付を確認することができる
      - con
        - 複数日のイベントで削除したはずなのに、イベントの日付が消えてくれない
          - 削除できないことがわかるようなデザインにすれば問題なさそう
          - 複製する要素は、opacityかけて表示するなど
          - 後からeventDateを編集してmultiの要素と同じなった場合の処理をしないといけない
    - 3 ~~そのままにする~~
      - 登録する際は、eventDateとmultiの値どちらも登録する
      - eventDateがmultiに含まれている場合重複するので保存する際は気をつける
      - pro
        - 複数日のイベント削除できないことがない
        - 日付も勝手に変わることはない
      - con
        - 複数日のイベントを確認する際に、全てのイベントが表示されるわけではない
          - 結構致命的な気がする
          - 登録する位置を確認したのに、余計に登録される時がある
  - 結論
    - 2にする
- `要素を横に並べる方法`
  - やってみたけど、気持ち悪い感じなってしまった
    - Time表示非表示でレイアウトが変わってしまうので気持ち悪い
- `表示する要素の数に制限をつけるか考える`
  - 日付をたくさん選んだ場合に、表示する要素が膨大になるので、レイアウトが気持ち悪くなる
    - なので表示としては省略をデフォとして、タップされたら全て表示のような形が分かりやすい気がする
  - 結論
    - 省略して表示はやろう
      - Edit画面は日付以外の要素も表示するので、それらも簡単にアクセスできるよ運しないといけない
        - そのため、日付だけを大きく表示するようなことは避けたい
  - 例  
    - 1 2020.5.20 , 2020.4.30, ....
      - でタップしたら複数日ダイアログを表示するようにする
      - con
        - 1 元の日付を直したい場合、どうすれば戻れるかわからない
          - 現在の実装だと直すには、複数日を全て削除しないといけない
            - ただこれをユーザにやってもらうので無理な気がする
            - 明確に戻る導線が必要な感じがする
          - これを直すには
            - 1 eventのdateと複数日の表示を分けないといけない
              - ただ分けると
                - 複数日の中にeventの日付が存在しない場合に。表示がよくわからないことになる
                  - eventのdateが幅の情報しか持たなくなってしまう
                  - 複数日のなかにEventDateは存在しなくていいか
                    - 複数日の日付とEventDateが違うものとして考える
            - 2 複数日のモーダルで日付の期間を選択できるようにする
              - 1日や3日などをmenuで選択できるようにする
              - そうすることで、EventのDateの状態が必要なくなる
        - 2 singleの時はdatepickerが、multiの時はmodalが表示されて統一性がない
          - 同じ項目をタップしてるのに、状態によって表示するものが異なるのが違和感を感じる
          - かといって、どちらもmodalにして動きを揃えても、どちらがどちらなのか分かりづらい感じがする
- `省略の表示方法を考える`
  - 方法
    - 1 テキストで並べて、省略表示する
    - 2 wrapで表示する

## MultiDateRangePickerを実装する

- todo
  - [x] 何を返すようにするか考える
  - [x] navigator
  - [x] base実装
  - [x] カレンダー表示
  - [x] Event渡すようにする
  - [x] 選択した日付がカレンダーに表示されるようにする
  - [x] 複数日はどのように実現するか考える
  - [x] returnはどうするか考える
  - [x] 日付を返すようにする
  - [x] 月の表示方法考える
  - [x] デザイン調整
  - [x] リファクタリング
  - [x] 多言語対応

- 何を返すようにするか考える
  - 案
    - 1 DateRangeのリストを返すようにする
    - 2 イベントのリストを返すようにする
      - これは過度な責務な気がする
      - 登録画面のイベントの設定とpicker側のイベントにズレが生じる気がする
      - イベントの設定は登録画面に任せるべき
  - 結論
    - 1 のDateRangeのみを返すようにする
- 複数日の時にmultiされたらどうするか
  - 方法
    - 1 選んだ日付も複数日とおなじdiffを持ってる状態にする
      - pro
        - 複数日もmultiで選択できるのが直感的に感じる
        - イベントなど複数日の予定を複数登録したい場合は存在するはず
      - con
        - editorにEventDateと複数日の日付を表示しないといけない
          - ここの区別がしづらいので分かりづらく感じる気がする
          - > これは同じ場所に表示するようにすればいい気がする
          - > タップすると複数日の選択になる
          - > キャンセルの方法が微妙だな
            - 空 or 単数の時は元の状態に戻すようにする
            - それ以外はmultiモードにする
          - 元の日付の長さに戻すのが大変そう
    - 2 単数しか選べないようにする
      - pro
      - con
        - 操作が直感的ではないように感じる
          - 複数日の時、multiを選んだら増やすやつもmultiになってるのが直感的
  - 結論
    - 1にする
      - ユーザがより直感的に使えるようにする
- returnはどうするか考える
  - 方法
    - 1 List<DateTime>
      - pro
        - 実装が簡単
      - con
    - 2 List<DateRange>
      - multiで選択した時点でRangeを確定させてしまう
      - pro
      - con
        - 再度編集する時に、Rangeの幅が異なる現象が起きる気がする
          - 複雑になるのを避けるために、一回の登録でできるのは単一のRangeに揃えたい気がする
          - その制約があってもそんなに問題がないように感じる
  - 結論
    - いったん1で
      - 問題あれば再度考える

## modal実装

- 項目は少ないが、デザインを調整したらいい感じに表示できそう

- pro
  - デザイン的に問題なさそう
- con

## ツールバー実装

- pro
- con
  - floating action buttonを上に移動させないといけないけど、これ気持ち悪いな
    - floating action buttonではなく、保存ボタンをツールバー常に配置するか
  - 保存ボタンと要素が同グループとして認識してしまうため、分かりづらい
  - デザイン的に微妙に感じる
- 結論
  - 微妙な気がする

## デザインを考える

- 1 下にツールバーを作り、要素を並べ選択形式にする
  - > 微妙
- 2 add option形式にして押下されたらmodal表示して選択する
  - 選択項目がmemoとマルチの2択だけなので、微妙
  - 今後追加するとしても
    - リマインダ機能
    - 繰り返し機能
- 3 カレンダーにボタンを配置する
  - 複数日を選択できるボタンをおく
