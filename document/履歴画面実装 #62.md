# 履歴画面実装 #62

- todo
  - [x] 実装方法を考える
  - [x] pin機能を実装するかどうか
  - [x] 命名どうすうるか
  - [x] 履歴はカレンダーに属するものなのかどうか
  - [x] infra実装
  - [x] domain実装
  - [x] 画面に表示
  - [x] リストがアニメーションするようにする
  - [x] rippleのアニメーションどうするか
  - [x] heroアニメーションできないか調べる
  - [x] すでに同じ名前が入力されている時の処理
  - [x] 最新の履歴が上位に表示されるようにする
  - [x] pinと削除機能をどのように共存させるか
  - [x] 削除機能実装
  - [x] pin実装削除する
  - [x] captionいるかどうか
  - [x] divider入れるかどうか
  - [x] eventhistoryservice命名
  - [x] リファクタリング
  - [x] 動作確認

## eventhistoryservice命名

- メソッドの機能
  - 同じ名前のものが存在したら削除する
  - 新しくEventHistoryを追加する
- メソッドの命名
  - 機能ではputのような働きをするので、saveorupdate
    - keyとしてnameを扱うことを示せればいい
- 結論
  - saveOrUpdateEventHistoryUseNameAsKey

## divider入れるかどうか

- 入れる
  - しつこい感じがする
  - 境界線が明確なので、削除ボタンがどの履歴に属してるのか把握しやすい
- 入れない
  - 削除ボタンが何に関連してるのかわかりづらい
- 結論
  - 入れる
    - しつこい感じはするが
    - dividerがある方が、境界線が明確になり、削除ボタンがどの履歴に属してるのかわかりやすいため入れる

## 最新の履歴が上位に表示されるようにする

- 新規で登録する場合は
  - 単純に追加
- 重複する場合は
  - 上書きする
- 方法
  - 1 名前をkeyにして登録する
    - これは微妙な気がする
    - 今後同じ名前でも違うものとして区別する場合対応することができなくなってしまう
    - つまり拡張性を下げることになるのでやめよう
  - 2 条件分岐を含んだメソッドを作る
    - 同じ名前のイベントを区別することができるので拡張性がある
    - 命名がわかりづらい気がする
      - 名前が重複した場合、上書き update
      - それ以外は、追加 save

## heroアニメーションできないか調べる

- local_hero
  - 同じ画面内でheroアニメーションのようなことができる
  - localheroは同じWidgetではないと厳しそう
  - 1対多のの動作ができなさそう
    - tagを動的に設定するようにすればいいのか
  - 実装が煩雑になる&今回の対応とは筋がずれるため別issueにしました
    - <https://github.com/aaazlkm/simple-calendar-app/issues/68>

## pinと削除機能をどのように共存させるか

- イベント編集画面の方に、pinを表示するのか、削除ボタンを表示するのか
- 考えること
  - pinのアイコンが微妙
    - material icon使えば問題ない
  - 削除機能かpin機能どちらか片方のみを実装する
    <!-- - 削除機能とpin機能は一見異なる機能のように見えるが達成したいことは同じ
      - 削除機能は、使わない機能を削除することで、使うものを上位に表示するための機能
      - pin機能は、使う予定を上位に表示するための機能
      - つまり、どちらも使う予定を上位に表示する機能
      - したがって、これらを一緒に実装しても意味がなく、片方のみを実装するのがいい気がする
      - と思ったけど、そういうわけではなさそう
        - pin機能でも削除できる機能は欲しい場合がある -->
    - 単純にデザイン的に表示する場所が少ないので、イベント編集画面ではどちらか片方しか実装しない
      - もっと機能が必要な場合は履歴編集画面を作成する
  - 比較
    - 削除機能
      - メリット
        - 学習コストが低い
        - 直感的に使用することができる
          - 履歴に削除機能があることは他のアプリでも使われているので直感的
      - デメリット
        - 間違ってよく使うものを削除した時に再度登録しなおさないといけない
        - 使わない予定を毎回削除しないといけない
          - そんなに手間には感じなかった
          - 予定を探すついでに削除する感
    - pin機能
      - メリット
        - 使う予定を上位に表示することができる
          - 削除機能でも一度登録してしまえば最上位に表示することができるので、それほどメリットでもない気がしてきた
            - 削除機能は一度履歴からイベントを探す必要があるだけ
      - デメリット
        - 学習コストがある
          - 履歴に固定するイメージがないため、直感的にこれが何を意味するのか把握しづらい
          - 現にandroidのアプリでも頻繁に問い合わせがきている
        - 間違えて入力したものがずっと残ることになる
          - 下にしか表示されないので問題ない気もする
          - でも学習コストに負けて使わないユーザがいる場合、pin機能がすごいストレスになる気がする
            - 変な予定を登録した時にも履歴に残ってしまうため
  - pinの使い方がわからないのが一番嫌かもな
    - 使わない機能がよくアプリ上で表示されるのはうざったい感じがするな
      - これが煩雑な印象=シンプルではない印象を与えることになるんだろうな
    <!-- - 使わない機能があるのがアプリを使う上で違和感として残る感じがする -->
      <!-- - 使いこなせていない感じがする
      - そのせいで、アプリをあいすことができな気がする？
        - そうでもないか
        - LINEとかTwitterで使わない機能があるが、別に使いこなしていなくて嫌だとは感じたことはない
        - 使いたい時にその機能が存在さえしていればいいと思う -->
  - いったん削除機能で実装し、androidと使い心地を比べる
    - 特に問題なく使えそう
    - やはりこちらの方が直感的な機能にはなっている気がする
    - 削除するのはそんなに手間には感じない
  - イベントの特性
    - 以下の種類が存在する
      - 定期的に行われるイベント
      - その時だけ開催位されるイベント
        - 飲み会の予定とか
        - 引越しの予定とか
    - pin機能は上記の定期的に行われるイベントをより入力するために実装する
    - 削除機能では、定期的に行われるイベントが突発的なイベントで隠されることが多い
      - その点が微妙なんだよな
      - ただ実際に触ってみたところそんなに削除する手間は感じない
        - それに一度登録してしまえば最上位に表示されるので問題な気がしてきた
          - 最初の一回だけ履歴から探す手間が生じる
  - pin機能を使い人の割合が欲しいな
    - 多くのひとに使われているのであれば、pin機能でいい気がするし
    - 使いこなせていないのであれば削除機能の方がいい気がする
    - ただandroidの問い合わせをみると、使いこなせていない人が多そう
- 結論
  - 削除機能にする
    - 削除機能が直感的でわかりやすい
      - 違和感なく使用することができる
    - pin機能のメリットが、よく使う予定を上位に表示することができる、だがこれは削除機能でも一度登録すれば上位に表示されるのでそこまでメリットではない気がする
    - pin機能の学習コストが高そう
      - androidのカレンダーの状況をみる限りpin機能を使いこなせている人が少なさそう
        - 結構削除の問い合わせがくる
          - pinの機能がうまく使うことができていれば削除したいとあまり感じない気何する
        - pin機能が便利だと言われるレビューをもらったことがない
        - pin機能を持ったアプリが他にあまりないため、直感的に何が怒るのが理解しにくい
          - 俺もmemoやplay storeで使うにつれて慣れてきた感があるが、他のアポ売りであまりpinを使わないので慣れていない気がする
    - このアプリはシンプルで使いやすいアプリを目指しているので、誰かにとって使いづらい機能はできるだけ排除したい
- 反省点
  - 新しい機能を実装するときは、ユーザの学習コストも考えないといけない

## 履歴はカレンダーに属するものなのかどうか

- これはカレンダーの使い方による気がする
  - 機能別にカレンダーを管理する場合は、カレンダーごとに履歴を持った方がいい
  - 機能がかぶる状態でカレンダーを管理する場合は、まとめて履歴を管理した方がいい
- 考えること
  - カレンダーごとに履歴が異なることはわかりづらい気がする
    - これがうまく伝わっていないとユーザは困惑する気がする
      - これを伝えるのはなかなか難しい
    - カレンダーを新しく作るたびに履歴がまっさらになるからわかるか
  - 大抵カレンダーを複数管理する時は、機能別になることが多い気がする
    - 複数管理数場合
      - 会社と個人のカレンダーを分ける
      - 友達とカレンダーを共有する時
    - 機能別になるということは、そのカレンダーごとに使うイベントの種類も異なると思う
      - バイトのカレンダーとサークルで登録するカレンダーは予定の種類は異なるはず
  - カレンダーごとに履歴を管理しても対して問題な気がする
    - 新しくカレンダーを作るたびに、履歴がまっさらになるが、一度入力してしまえばまた履歴を使うことができるので大した手間にならない
  - カレンダーに属する形にしておけば、あとでカレンダーに属さない形にするのも修正が簡単
- 結論
  - カレンダーごとに属する形にする
    - カレンダーは機能ごとに分けることが多い気がする
      - 機能ごとに分けるということは、よく使う予定の種類も異なってくる
    - カレンダーを新しく作るたびに履歴がまっさらになってしまうが、一度登録してしまえばまた同じように履歴として使えるようになるので大した手間が生じない
    - カレンダーごとに履歴を管理してることは、カレンダーを新しく作るたびに毎回履歴がまっさらになっているのでわかるはず
    - あとでカレンダーに属さない形にする修正も簡単にできる

## pin機能を実装するかどうか

- 目的
  - pin機能を実装しなくても、削除機能を実装すれば十分な気がする
  - ここでは、本当にそうなのか考える
- 考えること
  - pin機能の目的
    - カレンダーの予定の中でもよく登録するものが存在するはず
      - バイトとか、サークルとか
      - それらを毎回一から入力するのが面倒
      - そのため入力する時に毎回履歴から選択すると入力する必要もないし、色も揃える努力をしなくて済む
  - 削除機能の目的
    - 履歴を削除したいとの要望をよくもらう
      - そのため削除機能を付けようと思っている
      - 個人的にはpin機能が存在すれば、履歴を削除する必要はない気がしてる
      - ただこの考えがうまく伝えわっていないように感じる
- 結論
  - やっぱりpin昨日は欲しいな
    - カレンダーの予定にはよく登録するものが存在する
    - それらの入力の手間を省略するために、pin機能が必要な気がする

## 命名どうすうるか

- 考えること
  - これを編集する画面の名前は、
    - 履歴編集画面
      - 入力の履歴をユーザがいじレルイメージがあっていい気がする
        - chromeでも履歴をいじることができる
    - 入力候補画面？
      - ユーザが編集できるイメージがないな
      - 候補はアプリ側が勝手に挙げるイメージがある
  - イベント登録画面での表示するときのcaptionの名前は
    - 履歴になる気がする
- 命名
  - 履歴
    - 最終的にはpinで固定したりするので、履歴以上の機能を持っている気がする
  - 候補
    - pinで固定する機能を実装しても違和感がない気がする
  - 予測
- 比較
  - 履歴
    - メリット
      - ユーザ側に表示する時にわかりやすい
    - デメリット
      - pinで固定するイメージがない
  - 候補
    - メリット
      - pinの機能があっても違和感がない
    - デメリット
      - ユーザに表示する時は履歴として表示する気がするので、プログラムとの齟齬がありわかりづらい
- 結論
  - 履歴にする
    - ユーザーにとってわかりやすい
    - ユーザ側に表示する文言とプログラム上の文言を揃えておきたい
      - 結局俺も機能を考える時に、ユーザに表示してる文言で機能を考えることになるため揃えた方がわかりやすい
        - 履歴と表示しているのに、プログラム上では候補だとわかりづらい
    - 履歴にpin機能があってもギリギリ許容できる気がする

## 実装方法を考える

- 欲しい機能
  - 履歴を表示する機能
  - 履歴を削除できる機能
    - androidでは実装していないが要望がある
    - 確かにWebとかの履歴も消すことができるもんな
  - 特定の履歴をpinで固定する機能
    - よく使う予定などが存在するはずなので、それを固定したい
- 方法  
  - 1 履歴用のテーブルを用意して、Event保存時に一緒に保存する
    - これにより自由に削除できたり、追加できたり、pinで固定することができる
  - 2 履歴はイベントがから持ってきて、pinするものだけクラスを用意する
    - 現在のAndroidの実装
    - これだと削除機能を実装のが大変
      - 削除する名前を持っておかないといけない感じになる
      - これは嫌だな
- 結論
  - 1 にする
    - 2は大変そう
